# Component Versions
agnosticv_operator_version: v0.1.2
babylon_anarchy_version: v0.12.3
# Anarchy CRDs should already be installed
babylon_anarchy_include_crds: false
babylon_anarchy_governor_version: v0.2.0
babylon_aws_sandbox_version: v0.0.5
poolboy_version: v0.3.12

# Default 2 replicas for Anarchy for high availability,
# may be set to 0 for standby cluster.
babylon_anarchy_replicas: 2

# Default values for private config source
babylon_private_deploy_key: ''
babylon_private_resources: []

babylon_resources:
  # Anarchy install and anarchy-operator deployment
  - name: Anarchy install
    helm_template:
      git:
        repo: https://github.com/redhat-cop/anarchy.git
        version: "{{ babylon_anarchy_version }}"
      dir: helm
      include_crds: "{{ babylon_anarchy_include_crds }}"
      values:
        namespace:
          name: anarchy-operator
        replicaCount: 2

  # Poolboy
  - name: Poolboy install
    helm_template:
      git:
        repo: https://github.com/redhat-cop/poolboy.git
        version: "{{ poolboy_version }}"
      dir: helm
      values:
        namespace:
          name: poolboy

  # Babylon configuration
  - name: Babylon Helm Template
    helm_template:
      dir: babylon-config
      values:
        anarchy:
          namespace: anarchy-operator
        # Evaluation to preserve boolean type
        catalogNamespaces: "{{ babylon_catalog_namespaces | default([]) }}"
        crossClusterBackup: >-
          {{ {
            "enable": babylon_cross_cluster_backup_enable | default(false) | bool,
            "kubeConfig": babylon_cross_cluster_backup_kubeconfig | default('')
          } }}

  # agnosticv-operator
  - name: AgnosticV Operator Deploy
    openshift_template:
      url: https://raw.githubusercontent.com/redhat-gpte-devopsautomation/agnosticv-operator/{{ agnosticv_operator_version }}/deploy-template.yaml
      parameters:
        AGNOSTICV_IMAGE: quay.io/redhat-gpte/agnosticv-operator:{{ agnosticv_operator_version }}
  - namespace: agnosticv-operator
    resources:
    - name: Agnosticv Operator Configuration
      template:
        file: agnosticv-operator-config.yaml.j2

# Cluster level resources
k8s_resources: "{{ babylon_resources }}"
